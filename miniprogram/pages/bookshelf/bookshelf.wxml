<!-- pages/bookshelf/bookshelf.wxml -->
<view class="bookshelf-page">
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-container" wx:if="{{!hasUserInfo}}">
    <view class="login-icon">ğŸ“š</view>
    <view class="login-text">ç™»å½•åå¯æŸ¥çœ‹æ‚¨çš„ä¹¦æ¶</view>
    <button class="login-btn" bindtap="onTapLogin">ç‚¹å‡»ç™»å½•</button>
  </view>
  
  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <block wx:else>
    <!-- é¡¶éƒ¨æ“ä½œæ  -->
    <view class="top-bar">
      <view class="page-title" wx:if="{{!isEditing}}">æˆ‘çš„ä¹¦æ¶</view>
      <view class="select-info" wx:else>å·²é€‰æ‹© {{selectedBooks.length}} æœ¬</view>
      
      <view class="action-area">
        <view class="edit-btn" bindtap="toggleEditMode" wx:if="{{!isEditing && booksData.shelfBooks.length > 0}}">
          ç¼–è¾‘
        </view>
        <view class="cancel-btn" bindtap="cancelEdit" wx:if="{{isEditing}}">
          å–æ¶ˆ
        </view>
      </view>
    </view>
    
    <!-- ä¹¦æ¶å†…å®¹ -->
    <scroll-view scroll-y class="bookshelf-content" wx:if="{{!loading}}">
      <!-- æœ€è¿‘é˜…è¯» -->
      <view class="recent-reading" wx:if="{{booksData.recentBooks.length > 0 && !isEditing}}">
        <view class="section-title">æœ€è¿‘é˜…è¯»</view>
        <view class="recent-books">
          <view class="recent-book-item" 
                wx:for="{{booksData.recentBooks}}" 
                wx:key="id">
            <view class="book-cover-container">
              <image class="book-cover" src="{{item.coverUrl}}" mode="aspectFill" lazy-load></image>
              <view class="book-progress-bar">
                <view class="progress-inner" style="width: {{item.progress}}%"></view>
              </view>
            </view>
            <view class="book-info">
              <view class="book-title">{{item.title}}</view>
              <view class="book-author">{{item.author}}</view>
              <view class="book-progress-text">å·²è¯»{{item.progress}}%</view>
              <view class="book-time">{{item.lastReadTime}}</view>
            </view>
            <view class="book-actions">
              <view class="read-btn" 
                    data-book-id="{{item.id}}" 
                    bindtap="onTapContinueReading">ç»§ç»­é˜…è¯»</view>
              <view class="remove-btn" 
                    data-book-id="{{item.id}}" 
                    bindtap="onTapRemoveRecent">ç§»é™¤</view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- ä¹¦æ¶å›¾ä¹¦ -->
      <view class="shelf-books">
        <view class="section-header">
          <view class="section-title">æˆ‘çš„ä¹¦æ¶</view>
          <view class="select-all" bindtap="toggleSelectAll" wx:if="{{isEditing}}">
            {{selectedBooks.length === booksData.shelfBooks.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
          </view>
        </view>
        
        <!-- ä¹¦æ¶ä¸ºç©º -->
        <view class="empty-shelf" wx:if="{{booksData.shelfBooks.length === 0}}">
          <view class="empty-icon">ğŸ“–</view>
          <view class="empty-text">ä¹¦æ¶ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«å»æ·»åŠ å›¾ä¹¦å§</view>
        </view>
        
        <!-- ä¹¦æ¶å›¾ä¹¦åˆ—è¡¨ -->
        <view class="book-grid" wx:else>
          <view class="book-item {{selectedBooks.includes(item.id) ? 'selected' : ''}}" 
                wx:for="{{booksData.shelfBooks}}" 
                wx:key="id" 
                data-book-id="{{item.id}}" 
                bindtap="onTapBook">
            <!-- ç¼–è¾‘æ¨¡å¼ä¸‹çš„é€‰æ‹©çŠ¶æ€ -->
            <view class="select-circle {{selectedBooks.includes(item.id) ? 'checked' : ''}}" wx:if="{{isEditing}}">
              <view class="select-inner" wx:if="{{selectedBooks.includes(item.id)}}"></view>
            </view>
            
            <!-- å›¾ä¹¦å°é¢ -->
            <view class="book-cover-container">
              <image class="book-cover" src="{{item.coverUrl}}" mode="aspectFill" lazy-load></image>
              <view class="new-tag" wx:if="{{item.isNew}}">æ–°</view>
            </view>
            <view class="book-title">{{item.title}}</view>
            <view class="book-update-time" wx:if="{{item.updateTime}}">{{item.updateTime}}</view>
          </view>
        </view>
      </view>
    </scroll-view>
    
    <!-- åŠ è½½ä¸­ -->
    <view class="loading-container" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>
    
    <!-- åº•éƒ¨ç¼–è¾‘å·¥å…·æ  -->
    <view class="bottom-toolbar" wx:if="{{isEditing}}">
      <view class="delete-btn" bindtap="deleteSelectedBooks">åˆ é™¤</view>
    </view>
  </block>
</view> 